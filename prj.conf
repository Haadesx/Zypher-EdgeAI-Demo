# SPDX-License-Identifier: MIT
# Zephyr Edge AI Demo - Kconfig Configuration
#
# This file configures the Zephyr kernel and required subsystems
# for running TensorFlow Lite Micro inference.

# =============================================================================
# C++ Support (Required for TensorFlow Lite Micro)
# =============================================================================
CONFIG_CPP=y
CONFIG_STD_CPP17=y
CONFIG_GLIBCXX_LIBCPP=y

# Full libc is required for TFLite-Micro
CONFIG_REQUIRES_FULL_LIBC=y
CONFIG_NEWLIB_LIBC=y

# =============================================================================
# TensorFlow Lite Micro
# =============================================================================
CONFIG_TENSORFLOW_LITE_MICRO=y

# Use CMSIS-NN optimized kernels for ARM Cortex-M
# This provides significant performance improvements
# CMSIS-NN disabled for Cortex-M3 (no DSP/SIMD) to prevent UsageFaults
# CONFIG_TENSORFLOW_LITE_MICRO_CMSIS_NN_KERNELS=y

# =============================================================================
# Memory Configuration
# =============================================================================

# Main stack size (for initialization)
CONFIG_MAIN_STACK_SIZE=4096

# System workqueue stack (used by various subsystems)
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2048

# Heap memory pool
CONFIG_HEAP_MEM_POOL_SIZE=16384

# =============================================================================
# Threading Configuration
# =============================================================================

# Enable thread stack analysis
CONFIG_THREAD_STACK_INFO=y
CONFIG_THREAD_NAME=y

# Stack sentinel for overflow detection
CONFIG_STACK_SENTINEL=y

# Thread runtime statistics
CONFIG_SCHED_THREAD_USAGE=y

# =============================================================================
# Logging Subsystem
# =============================================================================
CONFIG_LOG=y
CONFIG_LOG_MODE_IMMEDIATE=y
CONFIG_LOG_BUFFER_SIZE=2048
CONFIG_LOG_PROCESS_THREAD_STACK_SIZE=1024
CONFIG_LOG_PRINTK=y

# Log levels: 0=OFF, 1=ERR, 2=WRN, 3=INF, 4=DBG
CONFIG_LOG_DEFAULT_LEVEL=3


# Include function names in log output
CONFIG_LOG_FUNC_NAME_PREFIX_DBG=y

# =============================================================================
# Console / UART Output
# =============================================================================
CONFIG_CONSOLE=y
CONFIG_UART_CONSOLE=y
CONFIG_SERIAL=y

# Use interrupt-driven UART for better performance
CONFIG_UART_INTERRUPT_DRIVEN=y

# =============================================================================
# Debug and Profiling
# =============================================================================

# Enable assertions
# Assertions disabled - crash in assert_post_action on boot
CONFIG_ASSERT=n
# CONFIG_ASSERT_VERBOSE=y

# Thread analyzer for debugging
CONFIG_THREAD_ANALYZER=y
CONFIG_THREAD_ANALYZER_USE_PRINTK=y
CONFIG_THREAD_ANALYZER_AUTO=n

# Enable timing functions
CONFIG_TIMING_FUNCTIONS=y

# =============================================================================
# Hardware Configuration
# =============================================================================

# Enable GPIO (for potential LED status indicators)
CONFIG_GPIO=y

# =============================================================================
# Optimization
# =============================================================================

# Size optimizations
CONFIG_SIZE_OPTIMIZATIONS=y

# Remove unused sections
CONFIG_COMPILER_OPT="-ffunction-sections -fdata-sections"

# =============================================================================
# Entropy (required for some operations)
# =============================================================================
CONFIG_ENTROPY_GENERATOR=y
CONFIG_TEST_RANDOM_GENERATOR=y
